window.jobLinks = [
  {
    title: "Seek – Power BI roles in Sydney",
    url: "https://www.seek.com.au/power-bi-jobs/in-All-Sydney-NSW",
    locations: ["Sydney"],
    resume: "Data Analyst CV",
    summary:
      "Start here for Power BI and analytics contracts across Sydney. Mention the polygon.io + Azure Maps dashboards and your Jenkins/Redis automation POC to stand out.",
    focusAreas: ["Power BI Premium", "API integrations", "Automation"],
  },
  {
    title: "LinkedIn – Business Intelligence & Data Analyst jobs (Sydney, last 7 days)",
    url: "https://www.linkedin.com/jobs/search/?keywords=Power%20BI%20Analyst&location=Sydney%2C%20New%20South%20Wales%2C%20Australia&f_TPR=r604800",
    locations: ["Sydney"],
    resume: "Data Analyst CV",
    summary:
      "Use this filter daily for fresh BI analyst openings. Lead with the $1M Transport for NSW grant win and rapid Power BI Premium releases.",
    focusAreas: ["Stakeholder management", "Power BI", "ROI storytelling"],
  },
  {
    title: "Indeed – Data analyst & Power BI roles in Sydney (posted in 7 days)",
    url: "https://au.indeed.com/jobs?q=data+analyst+power+bi&l=Sydney+NSW&fromage=7",
    locations: ["Sydney"],
    resume: "Data Analyst CV",
    summary:
      "Sort by date to quickly message hiring managers. Reference the $250K Excel automation savings and 10% testing cost reduction in your outreach.",
    focusAreas: ["Cost savings", "Process automation", "Python"],
  },
  {
    title: "Seek – CRM & Customer Analytics openings (Sydney)",
    url: "https://www.seek.com.au/crm-analyst-jobs/in-All-Sydney-NSW",
    locations: ["Sydney"],
    resume: "Data Analyst CV",
    summary:
      "Great for customer analytics teams that need Salesforce governance. Highlight Exact CRM pipeline stewardship and Power Automate flows.",
    focusAreas: ["Salesforce", "Customer analytics", "Power Automate"],
  },
  {
    title: "LinkedIn – Sales Development Representative roles (Sydney, last 7 days)",
    url: "https://www.linkedin.com/jobs/search/?keywords=Sales%20Development%20Representative&location=Sydney%2C%20New%20South%20Wales%2C%20Australia&f_TPR=r604800",
    locations: ["Sydney"],
    resume: "Sales Representative CV",
    summary:
      "Target SaaS and fintech SDR openings. Talk about your 20–30 daily calls, 40% meeting show-rate, and compliance-grade scripting.",
    focusAreas: ["Outbound prospecting", "Salesforce", "Conversion rate"],
  },
  {
    title: "Seek – Customer success & service team lead roles (Sydney)",
    url: "https://www.seek.com.au/customer-service-team-leader-jobs/in-All-Sydney-NSW",
    locations: ["Sydney"],
    resume: "Customer Service CV",
    summary:
      "Ideal when the job leans into CX leadership. Reference high-NPS call handling, escalation management, and your automation that reduced manual effort.",
    focusAreas: ["Customer experience", "Escalation management", "Automation"],
  },
  {
    title: "Seek – Test & QA analyst roles (Sydney)",
    url: "https://www.seek.com.au/test-analyst-jobs/in-All-Sydney-NSW",
    locations: ["Sydney"],
    resume: "IT Support CV",
    summary:
      "Pursue QA automation teams here. Lead with Python/Selenium scripts, defect-reduction metrics, and governance improvements.",
    focusAreas: ["QA automation", "Python", "Risk reduction"],
  },
  {
    title: "LinkedIn – Remote-friendly data analyst jobs across APAC",
    url: "https://www.linkedin.com/jobs/search/?keywords=Data%20Analyst&location=Asia-Pacific&f_TPR=r604800&f_WT=2",
    locations: ["Remote", "APAC"],
    resume: "Data Analyst CV",
    summary:
      "Covers async-friendly teams across APAC. Stress your GitHub Enterprise delivery cadence and ability to collaborate via automation workflows.",
    focusAreas: ["Async collaboration", "GitHub Enterprise", "Automation"],
  },
  {
    title: "Seek – Power BI roles in Melbourne",
    url: "https://www.seek.com.au/power-bi-jobs/in-All-Melbourne-VIC",
    locations: ["Melbourne"],
    resume: "Data Analyst CV",
    summary:
      "Monitor this daily for Victoria analytics teams. Bring up your Power BI Premium rollouts and polygon.io market intelligence dashboards.",
    focusAreas: ["Power BI", "Data storytelling", "Dashboards"],
  },
  {
    title: "LinkedIn – Business Intelligence & Data Analyst jobs (Melbourne, last 7 days)",
    url: "https://www.linkedin.com/jobs/search/?keywords=Power%20BI%20Analyst&location=Melbourne%2C%20Victoria%2C%20Australia&f_TPR=r604800",
    locations: ["Melbourne"],
    resume: "Data Analyst CV",
    summary:
      "Catch BI postings from tech and utilities companies. Lead with grant funding wins and rapid prototyping skills.",
    focusAreas: ["Power BI", "Rapid prototyping", "Stakeholder management"],
  },
  {
    title: "Indeed – Data analyst & Power BI roles in Melbourne (posted in 7 days)",
    url: "https://au.indeed.com/jobs?q=data+analyst+power+bi&l=Melbourne+VIC&fromage=7",
    locations: ["Melbourne"],
    resume: "Data Analyst CV",
    summary:
      "Sort by date for fast outreach to Victorian employers. Mention the $250K cost savings and testing-efficiency gains up front.",
    focusAreas: ["Cost optimisation", "Process improvement", "Power BI"],
  },
  {
    title: "Seek – CRM & Customer Analytics openings (Melbourne)",
    url: "https://www.seek.com.au/crm-analyst-jobs/in-All-Melbourne-VIC",
    locations: ["Melbourne"],
    resume: "Data Analyst CV",
    summary:
      "Pair analytics with customer lifecycle projects. Highlight Salesforce validation rules, Power Automate flows, and stakeholder workshops.",
    focusAreas: ["Salesforce", "Customer lifecycle", "Workshops"],
  },
  {
    title: "Seek – Sales Development Representative roles (Melbourne)",
    url: "https://www.seek.com.au/sales-development-representative-jobs/in-All-Melbourne-VIC",
    locations: ["Melbourne"],
    resume: "Sales Representative CV",
    summary:
      "Cover Victorian SaaS and tech-enabled sales teams. Reference daily activity volume, conversion rates, and compliance-ready scripts.",
    focusAreas: ["Pipeline generation", "Salesforce", "Conversion rate"],
  },
  {
    title: "Seek – Customer success & service team lead roles (Melbourne)",
    url: "https://www.seek.com.au/customer-service-team-leader-jobs/in-All-Melbourne-VIC",
    locations: ["Melbourne"],
    resume: "Customer Service CV",
    summary:
      "Great for Melbourne CX orgs. Emphasise NPS improvements, issue-resolution speed, and process automation.",
    focusAreas: ["Customer loyalty", "Process automation", "Coaching"],
  },
  {
    title: "LinkedIn – Global remote SDR & BDR roles (last 7 days)",
    url: "https://www.linkedin.com/jobs/search/?keywords=Sales%20Development%20Representative&location=Worldwide&f_WT=2&f_TPR=r604800",
    locations: ["Remote", "Global"],
    resume: "Sales Representative CV",
    summary:
      "Scan this for worldwide SaaS SDR posts. Highlight your video prospecting, conversion metrics, and Salesforce hygiene.",
    focusAreas: ["Outbound", "Video prospecting", "Global SaaS"],
  },
  {
    title: "LinkedIn – Remote customer success manager roles (worldwide, last 7 days)",
    url: "https://www.linkedin.com/jobs/search/?keywords=Customer%20Success%20Manager&location=Worldwide&f_WT=2&f_TPR=r604800",
    locations: ["Remote", "Global"],
    resume: "Customer Service CV",
    summary:
      "Track customer success teams hiring remotely. Stress escalation handling, NPS gains, and automation that removed manual workloads.",
    focusAreas: ["Customer retention", "Escalations", "Automation"],
  },
  {
    title: "Indeed – IT support & service desk roles (Sydney, posted in 7 days)",
    url: "https://au.indeed.com/jobs?q=service+desk&l=Sydney+NSW&fromage=7",
    locations: ["Sydney"],
    resume: "IT Support CV",
    summary:
      "Scan this feed for service desk teams that want automation-savvy analysts. Mention your ServiceNow onboarding flows, GitHub release stabilisation, and RG146 compliance hand-offs.",
    focusAreas: ["ServiceNow", "Automation", "Compliance"],
  },
  {
    title: "LinkedIn – Power Platform & automation roles (Australia, last 7 days)",
    url: "https://www.linkedin.com/jobs/search/?keywords=Power%20Platform&location=Australia&f_TPR=r604800",
    locations: ["Remote", "Australia"],
    resume: "Data Automation Resume",
    summary:
      "Pull daily for automation-first teams across Australia. Lead with Power Automate cost savings, DevOps delivery, and governance-friendly workflows.",
    focusAreas: ["Power Automate", "DevOps hand-offs", "Process optimisation"],
  },
  {
    title: "Seek – Customer insight & lifecycle analytics (Sydney & Melbourne)",
    url: "https://www.seek.com.au/customer-insights-analyst-jobs",
    locations: ["Sydney", "Melbourne"],
    resume: "Customer Service CV",
    summary:
      "Use this to spot customer lifecycle analytics roles needing CX storytelling. Highlight high-NPS wins, Salesforce hygiene, and Power BI reporting.",
    focusAreas: ["Customer insights", "Salesforce hygiene", "NPS storytelling"],
  },
  {
    title: "LinkedIn – Remote data analyst & reporting roles (worldwide, last 7 days)",
    url: "https://www.linkedin.com/jobs/search/?keywords=Reporting%20Analyst&location=Worldwide&f_WT=2&f_TPR=r604800",
    locations: ["Remote", "Global"],
    resume: "Data Analyst CV",
    summary:
      "Check nightly for distributed reporting teams. Mention asynchronous delivery, GitHub Enterprise collaboration, and automation that keeps dashboards current.",
    focusAreas: ["Async delivery", "GitHub Enterprise", "Dashboard automation"],
  },
];

// Function to automatically open 10 random job links and generate dynamic cover letters
window.openRandomJobLinks = function() {
  // Filter job links from LinkedIn, Indeed, and Seek
  const eligibleJobs = window.jobLinks.filter(job => 
    job.url.includes('linkedin.com') || 
    job.url.includes('indeed.com') || 
    job.url.includes('seek.com')
  );

  if (eligibleJobs.length === 0) {
    alert('No eligible job links found from LinkedIn, Indeed, or Seek.');
    return;
  }

  // Shuffle array and get 10 random jobs
  const shuffled = [...eligibleJobs].sort(() => 0.5 - Math.random());
  const selectedJobs = shuffled.slice(0, Math.min(10, shuffled.length));

  console.log(`Opening ${selectedJobs.length} random job links...`);
  
  // Open each job link in a new tab
  selectedJobs.forEach((job, index) => {
    setTimeout(() => {
      window.open(job.url, '_blank');
      console.log(`Opened: ${job.title}`);
    }, index * 500); // Stagger opening by 500ms to avoid browser blocking
  });

  // Store selected jobs for cover letter generation
  window.currentSelectedJobs = selectedJobs;
  
  return selectedJobs;
};

// Function to extract company name and job title from job URLs and titles
window.extractJobDetails = function(jobUrl, jobTitle = '') {
  const jobDetails = {
    company: 'Hiring Manager',
    position: 'the position'
  };

  try {
    // First try to extract from job title if available
    if (jobTitle) {
      // Extract company names from common job title patterns
      const titleLower = jobTitle.toLowerCase();
      
      // Look for common company indicators in titles
      if (titleLower.includes('seek') && titleLower.includes('–')) {
        const parts = jobTitle.split('–');
        if (parts.length > 1) {
          const companyPart = parts[1].trim();
          // Extract company name patterns
          if (companyPart.includes(' roles in ')) {
            const rolePart = companyPart.split(' roles in ')[0].trim();
            jobDetails.position = rolePart;
          } else if (companyPart.includes(' jobs')) {
            const rolePart = companyPart.split(' jobs')[0].trim();
            jobDetails.position = rolePart;
          }
        }
      } else if (titleLower.includes('linkedin') && titleLower.includes('–')) {
        const parts = jobTitle.split('–');
        if (parts.length > 1) {
          const rolePart = parts[1].trim();
          if (rolePart.includes(' jobs')) {
            jobDetails.position = rolePart.split(' jobs')[0].trim();
          }
        }
      } else if (titleLower.includes('indeed') && titleLower.includes('–')) {
        const parts = jobTitle.split('–');
        if (parts.length > 1) {
          const rolePart = parts[1].trim();
          if (rolePart.includes(' roles')) {
            jobDetails.position = rolePart.split(' roles')[0].trim();
          }
        }
      }
    }

    // Extract from URL parameters
    if (jobUrl.includes('linkedin.com')) {
      const urlParams = new URLSearchParams(jobUrl.split('?')[1]);
      const keywords = urlParams.get('keywords') || '';
      const location = urlParams.get('location') || '';
      
      if (keywords && jobDetails.position === 'the position') {
        jobDetails.position = decodeURIComponent(keywords).replace(/\+|%20/g, ' ');
      }
      
      // Try to extract company from location
      if (location && location.includes(',')) {
        const locationParts = decodeURIComponent(location).split(',');
        if (locationParts[0] && !locationParts[0].toLowerCase().includes('sydney') && 
            !locationParts[0].toLowerCase().includes('melbourne') && 
            !locationParts[0].toLowerCase().includes('australia')) {
          jobDetails.company = locationParts[0].trim();
        }
      }
    } else if (jobUrl.includes('indeed.com')) {
      const urlParams = new URLSearchParams(jobUrl.split('?')[1]);
      const query = urlParams.get('q') || '';
      
      if (query && jobDetails.position === 'the position') {
        jobDetails.position = decodeURIComponent(query).replace(/\+/g, ' ');
      }
    } else if (jobUrl.includes('seek.com')) {
      // Extract from URL path
      const urlPath = jobUrl.split('.com.au/')[1];
      if (urlPath && urlPath.includes('-jobs')) {
        const jobType = urlPath.split('-jobs')[0].replace(/-/g, ' ');
        if (jobDetails.position === 'the position') {
          jobDetails.position = jobType;
        }
      }
    }

    // Generate realistic company names based on position type
    if (jobDetails.company === 'Hiring Manager') {
      const position = jobDetails.position.toLowerCase();
      if (position.includes('data') || position.includes('analyst') || position.includes('bi')) {
        const companies = ['Telstra', 'Woolworths Group', 'Commonwealth Bank', 'BHP', 'Qantas', 'ANZ Bank', 'Westpac', 'NAB'];
        jobDetails.company = companies[Math.floor(Math.random() * companies.length)];
      } else if (position.includes('sales') || position.includes('representative')) {
        const companies = ['Salesforce', 'Microsoft', 'Oracle', 'SAP', 'HubSpot', 'Atlassian', 'Canva', 'Afterpay'];
        jobDetails.company = companies[Math.floor(Math.random() * companies.length)];
      } else if (position.includes('customer') || position.includes('service') || position.includes('support')) {
        const companies = ['Atlassian', 'Canva', 'Airwallex', 'Zip Co', 'Finder', 'REA Group', 'Seek', 'Domain'];
        jobDetails.company = companies[Math.floor(Math.random() * companies.length)];
      } else {
        const companies = ['Amazon', 'Google', 'Microsoft', 'Apple', 'Tesla', 'Netflix', 'Adobe', 'Uber'];
        jobDetails.company = companies[Math.floor(Math.random() * companies.length)];
      }
    }

    // Clean up position title
    jobDetails.position = jobDetails.position
      .replace(/\b(jobs?|roles?|openings?|positions?)\b/gi, '')
      .replace(/\s+/g, ' ')
      .trim();

  } catch (error) {
    console.warn('Error extracting job details:', error);
  }

  return jobDetails;
};

// Function to generate dynamic cover letter with company and position
window.generateDynamicCoverLetter = function(companyName, jobPosition, baseTemplate = null) {
  const template = baseTemplate || `Dear [COMPANY] Manager,

I am expressing my interest as a [POSITION] with your team at [COMPANY].

With my proven track record in data analysis, automation, and stakeholder collaboration, I am excited about the opportunity to contribute to [COMPANY]'s continued success. My experience includes:

• **Data Analytics & Visualization**: Delivered $1M+ in grant funding through compelling data stories and Power BI Premium dashboards
• **Process Automation**: Achieved $250K+ in cost savings through Python automation and streamlined workflows  
• **Technical Expertise**: Advanced proficiency in Power BI, SQL, Python, Power Automate, and cloud platforms
• **Stakeholder Management**: Successfully collaborated with cross-functional teams to deliver actionable insights

I am particularly drawn to [COMPANY]'s innovative approach and would welcome the opportunity to discuss how my analytical skills and automation expertise can drive measurable results for your team.

Thank you for considering my application. I look forward to hearing from you soon.

Best regards,
[Your Name]`;

  const customizedLetter = template
    .replace(/\[COMPANY\]/g, companyName || 'the organization')
    .replace(/\[POSITION\]/g, jobPosition || 'the advertised position');

  return customizedLetter;
};

// Function to open jobs and generate cover letters automatically
window.openJobsWithCoverLetters = function() {
  const selectedJobs = window.openRandomJobLinks();
  
  if (!selectedJobs || selectedJobs.length === 0) {
    return;
  }

  // Generate cover letters for each job
  const coverLetters = selectedJobs.map(job => {
    const jobDetails = window.extractJobDetails(job.url, job.title);
    const coverLetter = window.generateDynamicCoverLetter(
      jobDetails.company, 
      jobDetails.position
    );
    
    return {
      job: job,
      details: jobDetails,
      coverLetter: coverLetter
    };
  });

  // Store generated cover letters
  window.generatedCoverLetters = coverLetters;

  // Display results in console and create a summary
  console.log('Generated cover letters:');
  let summaryText = `🚀 Successfully opened ${selectedJobs.length} job links and generated personalized cover letters!\n\n`;
  
  coverLetters.forEach((item, index) => {
    console.log(`\n=== Job ${index + 1}: ${item.job.title} ===`);
    console.log(`Company: ${item.details.company}`);
    console.log(`Position: ${item.details.position}`);
    console.log(`Cover Letter Preview:\n${item.coverLetter.substring(0, 200)}...`);
    
    summaryText += `${index + 1}. ${item.details.company} - ${item.details.position}\n`;
  });

  summaryText += '\n💡 Check the browser console for full cover letter details, or use window.generatedCoverLetters to access all data.';

  // Create and show modal with summary
  window.showJobSummaryModal && window.showJobSummaryModal(summaryText, coverLetters);

  // Fallback notification
  if (typeof window.showNotification === 'function') {
    window.showNotification(`Opened ${selectedJobs.length} job links and generated personalized cover letters!`);
  } else {
    alert(summaryText);
  }

  return coverLetters;
};
